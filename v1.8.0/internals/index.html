<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Dev docs · ExplicitImports.jl</title><meta name="title" content="Dev docs · ExplicitImports.jl"/><meta property="og:title" content="Dev docs · ExplicitImports.jl"/><meta property="twitter:title" content="Dev docs · ExplicitImports.jl"/><meta name="description" content="Documentation for ExplicitImports.jl."/><meta property="og:description" content="Documentation for ExplicitImports.jl."/><meta property="twitter:description" content="Documentation for ExplicitImports.jl."/><meta property="og:url" content="https://ericphanson.github.io/ExplicitImports.jl/internals/"/><meta property="twitter:url" content="https://ericphanson.github.io/ExplicitImports.jl/internals/"/><link rel="canonical" href="https://ericphanson.github.io/ExplicitImports.jl/internals/"/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">ExplicitImports.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../api/">API reference</a></li><li class="is-active"><a class="tocitem" href>Dev docs</a><ul class="internal"><li><a class="tocitem" href="#Implementation-strategy"><span>Implementation strategy</span></a></li><li><a class="tocitem" href="#Internals"><span>Internals</span></a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Dev docs</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Dev docs</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/ericphanson/ExplicitImports.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/ericphanson/ExplicitImports.jl/blob/main/docs/src/internals.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Internal-details"><a class="docs-heading-anchor" href="#Internal-details">Internal details</a><a id="Internal-details-1"></a><a class="docs-heading-anchor-permalink" href="#Internal-details" title="Permalink"></a></h1><h2 id="Implementation-strategy"><a class="docs-heading-anchor" href="#Implementation-strategy">Implementation strategy</a><a id="Implementation-strategy-1"></a><a class="docs-heading-anchor-permalink" href="#Implementation-strategy" title="Permalink"></a></h2><ol><li>[DONE hackily] Figure out what names used in the module are being used to refer to bindings in global scope (as opposed to e.g. shadowing globals).<ul><li>We do this by parsing the code (thanks to JuliaSyntax), then reimplementing scoping rules on top of the parse tree</li><li>This is finicky, but assuming scoping doesn&#39;t change, should be robust enough (once the long tail of edge cases are dealt with...)<ul><li>Currently, I don&#39;t handle the <code>global</code> keyword, so those may look like local variables and confuse things</li></ul></li><li>This means we need access to the raw source code; <code>pathof</code> works well for packages, but for local modules one has to pass the path themselves. Also doesn&#39;t seem to work well for stdlibs in the sysimage</li></ul></li><li>[DONE] Figure out what implicit imports are available in the module, and which module they come from<ul><li>done, via a magic <code>ccall</code> from Discourse, and <code>Base.which</code>.</li></ul></li><li>[DONE] Figure out which names have been explicitly imported already<ul><li>Done via parsing</li></ul></li></ol><p>Then we can put this information together to figure out what names are actually being used from other modules, and whose usage could be made explicit, and also which existing explicit imports are not being used.</p><h2 id="Internals"><a class="docs-heading-anchor" href="#Internals">Internals</a><a id="Internals-1"></a><a class="docs-heading-anchor-permalink" href="#Internals" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ExplicitImports.find_implicit_imports" href="#ExplicitImports.find_implicit_imports"><code>ExplicitImports.find_implicit_imports</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">find_implicit_imports(mod::Module; skip=(mod, Base, Core))</code></pre><p>Given a module <code>mod</code>, returns a <code>Dict{Symbol, @NamedTuple{source::Module,exporters::Vector{Module}}}</code> showing names exist in <code>mod</code>&#39;s namespace which are available due to implicit exports by other modules. The dict&#39;s keys are those names, and the values are the source module that the name comes from, along with the modules which export the same binding that are available in <code>mod</code> due to implicit imports.</p><p>In the case of ambiguities (two modules exporting the same name), the name is unavailable in the module, and hence the name will not be present in the dict.</p><p>This is powered by <code>Base.which</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ericphanson/ExplicitImports.jl/blob/900a49f016548093362760728988d379f26b35b6/src/find_implicit_imports.jl#L16-L28">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ExplicitImports.get_names_used" href="#ExplicitImports.get_names_used"><code>ExplicitImports.get_names_used</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">get_names_used(file) -&gt; FileAnalysis</code></pre><p>Figures out which global names are used in <code>file</code>, and what modules they are used within.</p><p>Traverses static <code>include</code> statements.</p><p>Returns a <code>FileAnalysis</code> object.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ericphanson/ExplicitImports.jl/blob/900a49f016548093362760728988d379f26b35b6/src/get_names_used.jl#L620-L628">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ExplicitImports.analyze_all_names" href="#ExplicitImports.analyze_all_names"><code>ExplicitImports.analyze_all_names</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">analyze_all_names(file)</code></pre><p>Returns a tuple of two items:</p><ul><li><code>per_usage_info</code>: a table containing information about each name each time it was used</li><li><code>untainted_modules</code>: a set containing modules found and analyzed successfully</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ericphanson/ExplicitImports.jl/blob/900a49f016548093362760728988d379f26b35b6/src/get_names_used.jl#L411-L418">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ExplicitImports.inspect_session" href="#ExplicitImports.inspect_session"><code>ExplicitImports.inspect_session</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">ExplicitImports.inspect_session([io::IO=stdout,]; skip=(Base, Core), inner=print_explicit_imports)</code></pre><p>Experimental functionality to call <code>inner</code> (defaulting to <code>print_explicit_imports</code>) on each loaded package in the Julia session.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ericphanson/ExplicitImports.jl/blob/900a49f016548093362760728988d379f26b35b6/src/ExplicitImports.jl#L375-L379">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ExplicitImports.FileAnalysis" href="#ExplicitImports.FileAnalysis"><code>ExplicitImports.FileAnalysis</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">FileAnalysis</code></pre><p>Contains structured analysis results.</p><p><strong>Fields</strong></p><ul><li>per<em>usage</em>info::Vector{PerUsageInfo}</li><li><code>needs_explicit_import::Set{@NamedTuple{name::Symbol,module_path::Vector{Symbol},   location::String}}</code></li><li><code>unnecessary_explicit_import::Set{@NamedTuple{name::Symbol,module_path::Vector{Symbol},         location::String}}</code></li><li><code>untainted_modules::Set{Vector{Symbol}}</code>: those which were analyzed and do not contain an unanalyzable <code>include</code></li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ericphanson/ExplicitImports.jl/blob/900a49f016548093362760728988d379f26b35b6/src/get_names_used.jl#L31-L44">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../api/">« API reference</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.5.0 on <span class="colophon-date" title="Tuesday 2 July 2024 23:03">Tuesday 2 July 2024</span>. Using Julia version 1.10.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
